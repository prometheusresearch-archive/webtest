#!/usr/bin/env node

var wpbbt;
try {
  wpbbt = require('../lib');
} catch(_err) {
  require('babel/register')({stage: 0});
  wpbbt = require('../src');
}

var nomnom = require('nomnom');
var pkg = require('../package.json');
var fs = require('fs');

var options = nomnom
  .option('config', {
    abbr: 'c',
    help: 'Webpack configuration'
  })
  .option('port', {
    abbr: 'p',
    default: 3000,
    help: 'Port'
  })
  .option('headless', {
    flag: true,
    help: 'Run in headless mode (requires PhantomJS to be installed)'
  })
  .option('discover', {
    default: '**/__tests__/*-test.js',
    help: 'Glob patter to discover tests'
  })
  .option('debug', {
    flag: true,
    help: 'Debug mode'
  })
  .option('version', {
    flag: true,
    help: 'Print version and exit'
  })
  .parse();

if (options.version) {
  console.log(pkg.version);
  process.exit(0);
}

var cwd = process.cwd();

if (options._[0]) {
  var stat = fs.statSync(options._[0]);
  if (stat.isFile()) {
    options.discover = options._[0];
    cwd = process.cwd();
  } else if (stat.isDirectory()) {
    cwd = options._[0];
  }
}

wpbbt.start(cwd, options).then(
  function() {

  },
  function(err) {
    throw err;
  });
